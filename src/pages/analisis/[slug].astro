---
import Layout from '@/layouts/Layout.astro';
import articlesData from '@/data/articles.json';
import brandsData from '@/data/brands.json';

export async function getStaticPaths() {
  return articlesData.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const brand = brandsData.find(b => b.id === article.brandId);

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString('es-ES', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

const getScoreColor = (score: number) => {
  if (score >= 4.5) return { stroke: 'stroke-rating-excellent', text: 'text-rating-excellent', label: 'EXCELENTE' };
  if (score >= 4.0) return { stroke: 'stroke-rating-good', text: 'text-rating-good', label: 'MUY BUENO' };
  if (score >= 3.0) return { stroke: 'stroke-rating-average', text: 'text-rating-average', label: 'BUENO' };
  return { stroke: 'stroke-rating-poor', text: 'text-rating-poor', label: 'MEJORABLE' };
};

const colors = getScoreColor(article.rating);
---

<Layout title={`${article.title} | PetFood Expert`} description={article.excerpt}>
  <section class="relative bg-gradient-to-br from-primary/5 via-background to-accent/5 py-8 overflow-hidden">
    <div class="absolute inset-0 paw-pattern opacity-30"></div>
    <div class="container relative">
      <a href="/articulos" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-muted transition-colors mb-6">
        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        Volver a reviews
      </a>

      <div class="grid lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2">
          <div class="flex items-center gap-3 mb-4">
            <span class={`inline-flex items-center gap-1 rounded-full font-medium text-sm px-3 py-1 ${
              article.petType === 'perro' ? 'bg-dog-light text-dog' : 'bg-cat-light text-cat'
            }`}>
              <span>{article.petType === 'perro' ? 'üêï' : 'üêà'}</span>
              <span class="capitalize">{article.petType}</span>
            </span>
            <span class="text-sm text-muted-foreground bg-secondary px-3 py-1 rounded-full">
              {article.category}
            </span>
          </div>

          <h1 class="text-3xl md:text-4xl lg:text-5xl font-heading font-bold mb-4">
            {article.title}
          </h1>

          <p class="text-lg text-muted-foreground mb-6 max-w-2xl">
            {article.excerpt}
          </p>

          <div class="flex flex-wrap items-center gap-4 text-sm text-muted-foreground">
            <span class="flex items-center gap-1.5 bg-secondary/50 px-3 py-1.5 rounded-full">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/></svg>
              {formatDate(article.publishDate)}
            </span>
            <span class="flex items-center gap-1.5 bg-secondary/50 px-3 py-1.5 rounded-full">
              <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              {article.readTime} min de lectura
            </span>
            {brand && (
              <a href={`/marca/${brand.id}`} class="flex items-center gap-2 bg-primary/10 text-primary px-3 py-1.5 rounded-full hover:bg-primary/20 transition-colors">
                <span>{brand.logo}</span>
                {brand.name}
              </a>
            )}
          </div>
        </div>

        <div class="bg-card rounded-3xl p-6 border border-border shadow-card">
          <div class="text-center mb-4">
            <span class="text-6xl block mb-3">{article.image}</span>
            <div class="flex flex-col items-center">
              <div class="relative mb-3">
                <svg class="w-32 h-32 transform -rotate-90">
                  <circle cx="64" cy="64" r="45" stroke="currentColor" stroke-width="8" fill="transparent" class="text-secondary" />
                  <circle cx="64" cy="64" r="45" stroke="currentColor" stroke-width="8" fill="transparent" stroke-linecap="round" class={colors.stroke} style={`stroke-dasharray: ${2 * Math.PI * 45}; stroke-dashoffset: ${2 * Math.PI * 45 - (article.rating / 5 * 100 / 100) * 2 * Math.PI * 45};`} />
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                  <span class={`text-3xl font-bold ${colors.text}`}>{article.rating.toFixed(1)}</span>
                  <span class="text-xs text-muted-foreground">/ 5</span>
                </div>
              </div>
              <div class="flex gap-0.5 mb-1">
                {Array.from({ length: 5 }).map((_, i) => (
                  <svg key={i} class={`h-4 w-4 ${i < Math.floor(article.rating) ? 'text-rating-star fill-rating-star' : 'text-muted-foreground/30'}`} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                ))}
              </div>
              <span class={`text-xs font-bold tracking-wider ${colors.text}`}>{colors.label}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-12 bg-secondary/30">
    <div class="container">
      <div class="bg-card rounded-3xl p-8 border border-border mb-8">
        <h2 class="font-heading font-bold text-2xl mb-8 flex items-center gap-3">
          <svg class="h-6 w-6 text-primary" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
          Composici√≥n Nutricional
        </h2>

        <div class="flex flex-wrap justify-center gap-8 mb-10">
          <div class="flex flex-col items-center gap-2">
            <div class="h-28 w-28 rounded-full flex flex-col items-center justify-center ring-4 bg-primary/20 ring-primary">
              <span class="text-2xl font-bold text-primary">{article.ingredients.protein}<span class="text-sm">%</span></span>
            </div>
            <span class="text-sm font-medium text-muted-foreground">Prote√≠na</span>
          </div>
          <div class="flex flex-col items-center gap-2">
            <div class="h-28 w-28 rounded-full flex flex-col items-center justify-center ring-4 bg-accent/20 ring-accent">
              <span class="text-2xl font-bold text-accent">{article.ingredients.fat}<span class="text-sm">%</span></span>
            </div>
            <span class="text-sm font-medium text-muted-foreground">Grasa</span>
          </div>
          <div class="flex flex-col items-center gap-2">
            <div class="h-28 w-28 rounded-full flex flex-col items-center justify-center ring-4 bg-rating-good/20 ring-rating-good">
              <span class="text-2xl font-bold text-rating-good">{article.ingredients.fiber}<span class="text-sm">%</span></span>
            </div>
            <span class="text-sm font-medium text-muted-foreground">Fibra</span>
          </div>
          <div class="flex flex-col items-center gap-2">
            <div class="h-28 w-28 rounded-full flex flex-col items-center justify-center ring-4 bg-rating-average/20 ring-rating-average">
              <span class="text-2xl font-bold text-rating-average">{article.ingredients.carbs}<span class="text-sm">%</span></span>
            </div>
            <span class="text-sm font-medium text-muted-foreground">Carbohidratos</span>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-card rounded-2xl p-6 border border-border">
            <h4 class="font-heading font-semibold mb-4 flex items-center gap-2">
              <svg class="h-4 w-4 text-primary" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>
              Ingredientes Principales
            </h4>
            <div class="space-y-2">
              {article.ingredients.mainIngredients.map((ingredient: string) => (
                <div class="flex items-center gap-2">
                  <span class="h-2 w-2 rounded-full bg-primary"></span>
                  <span class="text-sm">{ingredient}</span>
                </div>
              ))}
            </div>
          </div>

          <div class="bg-card rounded-2xl p-6 border border-border">
            <h4 class="font-heading font-semibold mb-4 flex items-center gap-2">
              <svg class="h-4 w-4 text-rating-good" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 2a2 2 0 0 0-2 2v5H4a2 2 0 0 0-2 2v2c0 1.1.9 2 2 2h5v5c0 1.1.9 2 2 2h2a2 2 0 0 0 2-2v-5h5a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-5V4a2 2 0 0 0-2-2h-2z"/></svg>
              Aditivos y Vitaminas
            </h4>
            <div class="flex flex-wrap gap-2">
              {article.ingredients.additives.map((additive: string) => (
                <span class="bg-rating-good/10 text-rating-good text-xs px-2 py-1 rounded-full">
                  {additive}
                </span>
              ))}
            </div>
          </div>

          <div class="bg-card rounded-2xl p-6 border border-border">
            <h4 class="font-heading font-semibold mb-4 flex items-center gap-2">
              <svg class="h-4 w-4 text-accent" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>
              Conservantes
            </h4>
            <div class="flex flex-wrap gap-2">
              {article.ingredients.preservatives.map((preservative: string) => (
                <span class="bg-accent/10 text-accent text-xs px-2 py-1 rounded-full">
                  {preservative}
                </span>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-12">
    <div class="container">
      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-rating-excellent/5 rounded-3xl p-8 border border-rating-excellent/20">
          <h3 class="font-heading font-bold text-xl mb-6 flex items-center gap-3 text-rating-excellent">
            <div class="h-12 w-12 rounded-2xl bg-rating-excellent/20 flex items-center justify-center">
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>
            </div>
            Ventajas
          </h3>
          <ul class="space-y-4">
            {article.pros.map((pro: string) => (
              <li class="flex items-start gap-3">
                <svg class="h-5 w-5 text-rating-excellent shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                <span class="text-foreground">{pro}</span>
              </li>
            ))}
          </ul>
        </div>

        <div class="bg-destructive/5 rounded-3xl p-8 border border-destructive/20">
          <h3 class="font-heading font-bold text-xl mb-6 flex items-center gap-3 text-destructive">
            <div class="h-12 w-12 rounded-2xl bg-destructive/20 flex items-center justify-center">
              <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z"/></svg>
            </div>
            Desventajas
          </h3>
          <ul class="space-y-4">
            {article.cons.map((con: string) => (
              <li class="flex items-start gap-3">
                <svg class="h-5 w-5 text-destructive shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                <span class="text-foreground">{con}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section class="py-12">
    <div class="container">
      <div class="bg-gradient-to-br from-primary/10 via-accent/5 to-primary/10 rounded-3xl p-8 md:p-12 border border-primary/20 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-primary/5 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-accent/5 rounded-full blur-3xl"></div>

        <div class="relative">
          <div class="flex items-center gap-4 mb-6">
            <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-primary to-accent flex items-center justify-center">
              <svg class="h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>
            </div>
            <div>
              <h2 class="font-heading font-bold text-2xl">Veredicto Final</h2>
              <div class="flex items-center gap-2 mt-1">
                <div class="flex gap-0.5">
                  {Array.from({ length: 5 }).map((_, i) => (
                    <svg key={i} class={`h-4 w-4 ${i < Math.floor(article.rating) ? 'text-rating-star fill-rating-star' : 'text-muted-foreground/30'}`} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                  ))}
                </div>
                <span class="font-semibold text-foreground ml-1 text-sm">{article.rating.toFixed(1)}</span>
              </div>
            </div>
          </div>

          <p class="text-lg text-foreground leading-relaxed max-w-3xl">
            {article.verdict}
          </p>

          <div class="mt-8 flex flex-wrap gap-4">
            <a href="/articulos" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-hover hover:-translate-y-0.5 h-12 rounded-xl px-8 text-base">
              Ver m√°s reviews
            </a>
            {brand && (
              <a href={`/marca/${brand.id}`} class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border-2 border-primary bg-transparent text-primary hover:bg-primary hover:text-primary-foreground h-12 rounded-xl px-8 text-base">
                Ver m√°s de {brand.name}
              </a>
            )}
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
